<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		
		<link rel="stylesheet" href="css/public.css" />
		<link rel="stylesheet" href="css/gouwuche1.css" />
		
	</head>
	<body>
		<div id="head">
			<div class="wrap clear">
				<div class="left">
					<span>深圳</span>
					<a href="#">[切换城市]</a>
				</div>
			<div class="right">
				<ul>
					
					<li><a href="#">我的订单</a><i>|</i></li>
					<li><a href="#">我的糯米</a><i>|</i></li>
					<li><a href="#">登录</a><i>|</i></li>
					<li><a href="#">注册</a></li>
					
					
				</ul>
				
			</div>	
				
			</div>
		</div>
		
		<div id="main">
			<div class="wrap clear">
				<div class="logo clear">
					<h2><a href="#"></a><img src="img/goulougo.jpg"></a></h2>
					
					<div class="shopping-guocheng clear">
	    		<ul class="clear">
	    			<li class="on clear">
	    				
	    				<b class="b1"><img src="img/guocheng1.jpg"></b>
	    				<span class="t2">确认订单</span>
	    				<i style="margin-top:9px;"></i>
	    				
	    			</li>
	    			<li>
	    			
	    				<b class="b2"><img src="img/guocheng2.jpg"></b>	    			
	    				<span class="t3">选择支付方式</span>
	    					<i style="margin-top:9px;"></i>
	    			</li>
	    			<li>
	    				
	    				<b class="b3"><img src="img/guocheng3.jpg"></b>	    			
	    				<span class="t3">购买成功</span>
	    			</li>
	    		</ul>
	    	</div>
					
					
				</div>
				<table id="tab">
					<tbody>
						<tr>
							<th class="first">商品</th>
							<th width="150">单价</th>
							<th width="260">数量</th>
							<th width="150">小计</th>	
							<th width="150">删除</th>
						</tr>
						<!--<tr>
							<td class="vtop">
								<div class="shangpin">
									<div class="imgwrap">
										<a href="#"><img style="width:130px;height:79px;"src="img/8c1001e93901213f85534dba5ee736d12f2e9577.jpg"></a>
										
									</div>
									
									<div class="title">
										<a href="#">【御蝶坊】2磅无线魅力蛋糕一份</a>  
									</div>
									<div class="attr">
										
									</div>
									
									
								</div>
								
							</td>
							<td class="font14">￥128.00</td>
							<td class="shuliang">
								<div class="jiajian">
									<button>-</button>
									<input id="shu" type="text" value="1">
									<button>+</button>
									
									
								</div>
								
							</td>
							<td class="price">￥
								<span>128.00</span></td>
							
						</tr>
						-->
						
					</tbody>
				
				
				
				</table>
				
				<div class="zongjia">
					应付总额：<em id="zongjia1">$12354</em>
				</div>
				<div class="queren">
					<a href="#">确认</a>
				</div>
			</div>
			
			
			
		</div>
		<div id="footer">
			<div class="foot1">
				<a href="#">关于百度糯米</a><span>|</span>
				<a href="#">常见问题</a><span>|</span>
				<a href="#">廉政投诉举报</a><span>|</span>
				<a href="#">开放平台</a><span>|</span>
				<a href="#">用户协议</a><span>|</span>
				<span> 客服电话：4006-888-887（每天9:00 - 22:00</span>
			</div>
			<div class="foot2">
				<em>@copy;2015</em>
				<em>nuomi.com</em>
				<a href="#">京ICP证451565号</a>
				<em>京公网安备4153135415152号</em>
			</div>
		</div>
	</body>
</html>
<script type="text/javascript" src="js/jquery-1.8.3.min.js" ></script>
<script type="text/javascript" src="js/cookieTools.js" ></script>
<script>
	
		$(function(){
		//var obj=getCookie("userName");
		var num;
		var zong=null;
		var vel;
		$.get("getShoppingCart.php",{vipName:getCookie("userName")},function(data){
			var Str=eval('('+data+')');
			
			for(var i=0;i<Str.length;i++){
			
			num=parseInt(Str[i].goodsPrice)*parseInt(Str[i].goodsCount);
			$("#tab").append(
						/*'<tbody ord="'+Str[i].goodsId+'">'*/
						/*+'<tr>'
						+'<th class="first">商品</th>'
						+'<th width="150">单价</th>'
						+'<th width="260">数量</th>'
						+'<th width="150">小计</th>'
						+'<th width="150">删除</th>'
						+'</tr>'*/
						'<tr ord="'+Str[i].goodsId+'">'
						+'<td class="vtop">'
						+'<div class="shangpin">'
						+'<div class="imgwrap">'
						+'<a href="#"><img style="width:130px;height:79px;" src="'+Str[i].goodsImg+'"></a>'
										
						+'</div>'
									
						+'<div class="title">'
						+'<a href="#">'+Str[i].goodsName+'</a>'  
						+'</div>'
						+'<div class="attr">'
										
						+'</div>'
									
									
						+'</div>'
								
						+'</td>'
						+'<td class="font14">'+Str[i].goodsPrice+'</td>'
						+'<td class="shuliang">'
						+'<div class="jiajian">'
						+'<button class="sub">-</button>'
						+'<input class="shu" type="text" value="'+Str[i].goodsCount+'"/>'
						+'<button class="add">+</button>'
									
									
						+'</div>'
								
						+'</td>'
						+'<td class="price">￥'
						+'<span class="priceji">'+num+'</span></td>'
						+'<td class="shanchu">'
						+'<input class="shanchu" style="width:50px;height:20px;" type="button" value="删除">'
						+'</tr>'
						
						
						/*+'</tbody>'*/
			
			);
			
			zong+=num;
			
			vel+=parseInt(Str[i].goodsCount)
			}
			
			
			$("#zongjia1").html(zong);
			
			suan();
			zeng();
			remove();
		})
		});
		
		function suan(){
		$(".jiajian").on("click",".sub",function(){
			//alert($(this).index());
			var num1=parseInt($(this).next().val())-1;
			var that=this;
			if(num1>0){
				var goodsid=$(this).parents("tr").attr("ord");
				$.get("updateGoodsCount.php",{vipName:getCookie("userName"),goodsId:goodsid,goodsCount:num1},function(data){
					if(data=="1"){
						$(that).next().val(num1);
						zeng()
					}else{
						
						alert("加入失败");
					}
					
				})
					
			}	
		})
		
	$(".jiajian").on("click",".add",function(){
			var num1=parseInt($(this).siblings(".shu").val())+1;
			 var that=this;
			if(num1<=10){
				var goodsid=$(this).parents("tr").attr("ord");
				$.get("updateGoodsCount.php",{vipName:getCookie("userName"),goodsId:goodsid,goodsCount:num1},function(data){
					if(data=="1"){
						//console.log($(that).siblings(".shu").length)
						$(that).siblings(".shu").val(num1);
						zeng()
					}else{
						alert("加入失败");
					}
					
				})
					
			}	
		})
	}
	function zeng(){
		var shuliangResult=0;
		var zongPrice=0;
		for(var i=0;i<$(".font14").length;i++){
			shuliangResult+=parseInt($(".shu")[i].value);
			var num1=parseInt($(".font14")[i].innerHTML)*parseInt($(".shu")[i].value);
			$(".priceji")[i].innerHTML=num1;
			zongPrice+=num1;
		}
		$(".shu").html(shuliangResult);
		$("#zongjia1").html("￥"+zongPrice);
		
		
	}
	
	
	//
	 function remove(){
		
		$(".shanchu").click(function(){
			var that= this;
			var   goodsid= $(this).parents("tr").attr("ord");
			$.get("deleteGoods.php",{vipName:getCookie("userName"),goodsId:goodsid},function(data){
				if(data=="1"){
					$(that).parents("tr").remove()
					
					 zeng()
				}else{
					alert("删除失败");
				}
				
			})
			return false
		})
	}
	$(".queren").click(function(){
		alert("去结算");
	})
//	function shu(){
//	var Str=$(".shu");
//		
//		$(".add").click(function(){
//			
//			if(parseInt(Str.val())!=10){
//				
//				Str.val(parseInt(Str.val())+1);
//			}
//			
//		})
//		$(".sub").click(function(){
//			
//			if(parseInt(Str.val())!=1){
//				
//				Str.val(parseInt(Str.val())-1);
//			}
//			
//		})
//	}
</script>